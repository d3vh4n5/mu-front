---
import Main from '../components/Main.astro';
import Layout from '../layouts/Layout.astro';
import infoImg from '../assets/img/top-decorator.gif'
import { Image } from 'astro:assets';

// Welcome to Astro! Wondering what to do next? Check out the Astro documentation at https://docs.astro.build
// Don't want to use any of this? Delete everything in this file, the `assets`, `components`, and `layouts` directories, and start fresh.
---

<Layout>
	<Main>
		<div class="containar">
			<Image
				src={infoImg}
				alt={"Imagen"}
				class:list={"noticias"}
			/>
			<h1>Crear cuenta</h1>
			<section>
			<div id="message"></div>
				<form id="registerForm">
					<div class="input-group">
						<label>Usuario (Max 10)</label>
						<input type="text" id="username" maxlength="10" required>
					</div>
					<div class="input-group">
						<label>Contraseña (Max 10)</label>
						<input type="password" id="password" maxlength="10" required>
					</div>
					<div class="input-group">
						<label>Nombre Real</label>
						<input type="text" id="name" required>
					</div>
					<div class="input-group">
						<label>Correo Electrónico (Debe ser real para poder verificar la cuenta)</label>
						<input type="email" id="email" required>
					</div>
					<p>
						Al registrarse en este server, ser compromete a respetar el reglamento y acepta los terminos y condiciones
					</p>
					<button type="submit">CREAR CUENTA</button>
				</form>
			</section>
		</div>
	</Main>
</Layout>
<style>
	.noticias{
		width: 100%;
	}

	h1 {
		text-align: center;
		text-transform: uppercase;
		letter-spacing: 2px; 
	}
	.input-group {
		margin-bottom: 15px;
	}
	label {
		display: block;
		margin-bottom: 5px;
		font-size: 12px;
	}
	input {
		border: none;
		width: 100%;
		padding: 10px;
		box-sizing: border-box;
	}
	input:focus {
		outline: none;
	}
	button {
		width: 100%;
		padding: 12px;
		background: #d4af37;
		border: none;
		color: black;
		font-weight: bold;
		cursor: pointer;
		border-radius: 4px;
		transition: 0.3s;
		margin-top: 10px;
	}

	button:hover {
		background: #f1c40f;
	}

	#message {
		margin-top: 15px;
		text-align: center;
		font-size: 14px;
	}
</style>

<script>

import { config } from "../constants/config";

document.getElementById('registerForm').addEventListener('submit', async (e) => {
	e.preventDefault();
	const msgDiv = document.getElementById('message');
	msgDiv.innerHTML = "Procesando...";

	const data = {
		username: document.getElementById('username').value,
		password: document.getElementById('password').value,
		name: document.getElementById('name').value,
		email: document.getElementById('email').value
	};

	try {
		const response = await fetch('/api/register', {
			method: 'POST',
			headers: { 'Content-Type': 'application/json' },
			body: JSON.stringify(data)
		});

		const result = await response.json();

		if (response.ok) {
			msgDiv.innerHTML = `<span class="success">${result.message}</span>`;
			document.getElementById('registerForm').reset();
		} else {
			msgDiv.innerHTML = `<span class="error">${result.error}</span>`;
		}
	} catch (error) {
		console.error(error)
		msgDiv.innerHTML = `<span class="error">No se pudo conectar con la API</span>`;
	}
});

</script>
